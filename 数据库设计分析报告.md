# 数据库设计分析报告

## 📊 现有表结构分析

### ✅ 已有表（13张）

| 序号 | 表名 | 说明 | 状态 |
|------|------|------|------|
| 1 | `user` | 用户表 | ✅ 基本合理 |
| 2 | `user_address` | 用户地址表 | ✅ 合理 |
| 3 | `admin` | 管理员表 | ⚠️ 与项目不适配 |
| 4 | `product_category` | 商品分类表 | ✅ 合理 |
| 5 | `product` | 商品表 | ✅ 合理 |
| 6 | `product_image` | 商品图片表 | ✅ 合理 |
| 7 | `product_spec` | 商品规格表 | ⚠️ 设计需优化 |
| 8 | `shopping_cart` | 购物车表 | ✅ 合理 |
| 9 | `order` | 订单表 | ❌ 表名有问题 |
| 10 | `order_item` | 订单项表 | ✅ 合理 |
| 11 | `refund` | 退款表 | ✅ 合理 |
| 12 | `coupon` | 优惠券表 | ⚠️ 前端未用到 |
| 13 | `user_coupon` | 用户优惠券表 | ⚠️ 前端未用到 |

---

## ❌ 核心问题

### 问题 1: 用户/管理员表设计不匹配 ⚠️⚠️⚠️

**现状**:
```sql
-- 数据库设计：user 和 admin 分离
CREATE TABLE `user` (...)      -- 普通用户
CREATE TABLE `admin` (...)     -- 管理员
```

**前端实现**:
```javascript
// 前端代码：user 表统一管理，用 role 区分
const mockUsers = [
  { id: 1, username: 'user01', role: 'user' },      // 普通用户
  { id: 2, username: 'admin', role: 'merchant' }    // 商家
];
```

**问题分析**:
- ❌ 数据库用两张表，前端用一张表的 `role` 字段
- ❌ 后端需要额外的适配逻辑，增加复杂度
- ❌ 前端的 `role: 'merchant'` 无法直接映射到 `admin` 表

**影响**:
- 登录逻辑需要查询两张表
- 统一的用户管理变得复杂
- 可能导致前后端对接困难

---

### 问题 2: `order` 表名是 MySQL 保留字 ❌

**问题**:
```sql
CREATE TABLE `order` (...)  -- order 是 SQL 关键字
```

**影响**:
- 每次查询都必须用反引号包裹：`` `order` ``
- 容易出错，影响代码可读性
- 不符合命名规范

**建议**: 改名为 `orders` 或 `tb_order`

---

### 问题 3: 缺少逻辑删除字段 ⚠️

**现状**: 所有表都没有逻辑删除字段

**问题**:
- MyBatis-Plus 配置了逻辑删除：
  ```properties
  mybatis-plus.global-config.db-config.logic-delete-field=deleted
  mybatis-plus.global-config.db-config.logic-delete-value=1
  mybatis-plus.global-config.db-config.logic-not-delete-value=0
  ```
- 但表结构中没有 `deleted` 字段
- 会导致逻辑删除功能无法使用

**建议**: 核心业务表都应添加 `deleted` 字段

---

## 🔍 缺失的表（前端功能需要）

### 1. 商品评价表 ❌ 必需

**前端功能**:
- 用户个人中心有"我的评价"页面 (`ReviewList.vue`)
- 待评价列表、已评价列表
- 评价弹窗（评分、图片、内容）

**缺失**: 没有 `product_review` 表

**建议结构**:
```sql
CREATE TABLE `product_review` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `order_item_id` bigint NOT NULL COMMENT '订单项ID',
  `user_id` bigint NOT NULL,
  `product_id` bigint NOT NULL,
  `rating` tinyint NOT NULL COMMENT '评分1-5',
  `content` text COMMENT '评价内容',
  `images` varchar(1000) COMMENT '评价图片（JSON数组）',
  `created_time` datetime NOT NULL,
  PRIMARY KEY (`id`)
);
```

---

### 2. 用户收藏表 ❌ 必需

**前端功能**:
- 用户个人中心有"我的收藏"页面 (`FavoriteList.vue`)
- 收藏商品列表、取消收藏、清空收藏

**缺失**: 没有 `user_favorite` 表

**建议结构**:
```sql
CREATE TABLE `user_favorite` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` bigint NOT NULL,
  `product_id` bigint NOT NULL,
  `created_time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_product` (`user_id`, `product_id`)
);
```

---

### 3. 浏览历史表 ❌ 必需

**前端功能**:
- 用户个人中心有"浏览历史"页面 (`BrowsingHistory.vue`)
- 历史记录列表、删除记录、清空历史

**缺失**: 没有 `browsing_history` 表

**建议结构**:
```sql
CREATE TABLE `browsing_history` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` bigint NOT NULL,
  `product_id` bigint NOT NULL,
  `view_time` datetime NOT NULL COMMENT '浏览时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_time` (`user_id`, `view_time`)
);
```

---

### 4. 操作日志表 ❌ 必需

**前端功能**:
- 管理端有"操作日志"页面 (`AdminOperationLog.vue`)
- 记录商家的关键操作（商品编辑、订单处理等）
- 分类筛选、关键词搜索、时间范围查询

**缺失**: 没有 `operation_log` 表

**建议结构**:
```sql
CREATE TABLE `operation_log` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `operator_id` bigint NOT NULL COMMENT '操作人ID',
  `operator_name` varchar(50) NOT NULL COMMENT '操作人名称',
  `operation_type` varchar(50) NOT NULL COMMENT '操作类型',
  `operation_content` varchar(500) NOT NULL COMMENT '操作内容',
  `operation_object` varchar(100) COMMENT '操作对象',
  `created_time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_operator` (`operator_id`),
  KEY `idx_type` (`operation_type`)
);
```

---

### 5. 物流信息表 ⚠️ 建议添加

**前端功能**:
- 订单详情页显示物流信息
- 管理端发货时填写物流单号

**现状**: `order` 表没有物流相关字段

**建议**: 
- 方案 A：在 `order` 表添加字段（简单）
  ```sql
  `express_company` varchar(50) COMMENT '物流公司',
  `tracking_no` varchar(100) COMMENT '物流单号'
  ```
- 方案 B：创建独立的 `order_express` 表（复杂场景）

---

## ⚠️ 设计问题与优化建议

### 问题 4: `product_spec` 表设计不够灵活

**现状**:
```sql
CREATE TABLE `product_spec` (
  `spec_name` varchar(50) NOT NULL,   -- 颜色
  `spec_value` varchar(50) NOT NULL,  -- 红色
  ...
);
```

**问题**:
- 一条记录只能存一个属性（如"颜色:红色"）
- 无法表示多规格组合（如"颜色:红色 + 尺寸:XL"）
- 前端商品详情页的规格选择器无法很好支持

**建议**: 
- 简化设计，直接在商品详情中用 JSON 存储规格信息
- 或改用 SKU 表设计

---

### 问题 5: 缺少必要的索引

**现状分析**:
- ✅ 主键、外键索引都有
- ⚠️ 查询字段索引不完整

**建议添加索引**:
```sql
-- product 表
ALTER TABLE `product` ADD KEY `idx_price` (`price`);        -- 价格筛选
ALTER TABLE `product` ADD KEY `idx_sales` (`sales`);        -- 销量排序

-- order 表
ALTER TABLE `order` ADD KEY `idx_pay_time` (`pay_time`);    -- 支付时间查询
```

---

### 问题 6: `coupon` 和 `user_coupon` 表前端未用到

**现状**: 数据库有优惠券相关表，但前端完全没有优惠券功能

**建议**: 
- 方案 A：删除这两张表（简化）
- 方案 B：保留表，后续扩展优惠券功能

---

## 📝 字段级别问题

### 1. 密码字段长度不足
```sql
`password` varchar(100)  -- BCrypt 密码长度通常为 60
```
**建议**: 保持 100 长度足够，但注释应说明实际长度

### 2. 缺少软删除标记
```sql
-- 建议所有业务表添加
`deleted` tinyint NOT NULL DEFAULT 0 COMMENT '逻辑删除（0-未删除，1-已删除）'
```

### 3. 订单表缺少关闭原因字段
```sql
-- 建议添加
`cancel_reason` varchar(200) COMMENT '取消原因'
```

### 4. 商品表缺少销售属性字段
```sql
-- 建议添加
`is_hot` tinyint DEFAULT 0 COMMENT '是否热销',
`is_recommend` tinyint DEFAULT 0 COMMENT '是否推荐'
```

---

## 📊 与项目适配度评分

| 维度 | 评分 | 说明 |
|------|------|------|
| **核心表结构** | 7/10 | 基本表都有，但设计有问题 |
| **前端功能适配** | 5/10 | 缺少评价、收藏、历史、日志表 |
| **用户体系** | 3/10 | user/admin 分离与前端不匹配 |
| **规范性** | 6/10 | order 表名不规范，缺少逻辑删除 |
| **可扩展性** | 7/10 | 基本架构合理 |
| **综合评分** | **5.6/10** | **需要较大调整** |

---

## ✅ 推荐改进方案

### 方案 A: 最小调整（快速开发）

**目标**: 保持现有结构，添加必需表，修复关键问题

**改动**:
1. ✅ 合并 `user` 和 `admin` 表，添加 `role` 字段
2. ✅ 将 `order` 表改名为 `orders`
3. ✅ 添加 4 张缺失表（评价、收藏、历史、日志）
4. ✅ 核心表添加 `deleted` 字段
5. ✅ `order` 表添加物流字段
6. ⚠️ 删除 `coupon` 和 `user_coupon`（前端不需要）

**优点**: 改动小，快速适配前端
**缺点**: 规格表设计仍有局限

---

### 方案 B: 完整优化（推荐）

**目标**: 全面优化数据库设计，适配项目并预留扩展

**改动**:
1. ✅ 方案 A 的所有改动
2. ✅ 优化 `product_spec` 表为 `product_sku` 表
3. ✅ 添加更多索引
4. ✅ 添加更多业务字段（商品热销/推荐等）
5. ✅ 统一字段命名规范

**优点**: 设计更合理，扩展性更好
**缺点**: 改动较大，开发周期长

---

## 🎯 建议采用方案

**推荐：方案 A（最小调整）**

**理由**:
1. 项目时间紧张，需要快速上线
2. 前端功能已完整，后端需快速适配
3. 核心问题（用户表、缺失表）可快速解决
4. 后期可逐步优化（如规格表）

**预计工作量**:
- 修改 SQL 脚本：2 小时
- 创建实体类：3 小时
- 总计：约 5 小时

---

## 📋 具体修改清单

### 必须修改 ❌
1. **合并 user 和 admin 表** - 添加 role 字段
2. **order 表改名** - 改为 orders
3. **添加 4 张缺失表** - 评价、收藏、历史、日志
4. **添加逻辑删除字段** - deleted

### 建议修改 ⚠️
5. 添加物流字段到 orders 表
6. 删除 coupon 相关表（前端不需要）
7. 添加商品热销/推荐字段
8. 优化索引

### 可选修改 💡
9. 优化规格表设计
10. 添加更多冗余字段提升查询性能

---

## 🚀 下一步行动

如果您确认采用**方案 A**，我可以立即：

1. ✅ 生成修改后的完整 SQL 脚本
2. ✅ 创建对应的 Entity 实体类
3. ✅ 更新配置文件
4. ✅ 生成初始化数据

**是否需要我立即生成优化后的数据库脚本？**

