# WebShop é¡¹ç›®é—®é¢˜åˆ†æä¸æ”¹è¿›å»ºè®®

## ä¸€ã€å½“å‰å­˜åœ¨çš„ä¸»è¦é—®é¢˜

### 1. å®‰å…¨é—®é¢˜ï¼ˆä¸¥é‡ï¼‰

#### 1.1 è®¤è¯æˆæƒæœºåˆ¶ç¼ºå¤±
- **é—®é¢˜æè¿°**ï¼šå½“å‰ä½¿ç”¨ Mock Tokenï¼ˆ`mock-token-{userId}`ï¼‰ï¼Œæ²¡æœ‰çœŸå®çš„èº«ä»½éªŒè¯æœºåˆ¶
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **å½±å“èŒƒå›´**ï¼š
  - ä»»ä½•äººéƒ½å¯ä»¥ä¼ªé€  token è®¿é—®ç³»ç»Ÿ
  - æ— æ³•éªŒè¯è¯·æ±‚çš„çœŸå®æ€§å’Œåˆæ³•æ€§
  - ç”¨æˆ·èº«ä»½å¯è¢«è½»æ˜“å†’å……
- **ä»£ç ä½ç½®**ï¼š[`UserController.java:89`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/controller/UserController.java:89)

#### 1.2 å¯†ç åŠ å¯†æ–¹å¼ä¸å®‰å…¨
- **é—®é¢˜æè¿°**ï¼šä½¿ç”¨ MD5 åŠ å¯†å¯†ç ï¼Œå·²è¢«è¯æ˜ä¸å®‰å…¨
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **é—®é¢˜åˆ†æ**ï¼š
  - MD5 ç®—æ³•å·²è¢«ç ´è§£ï¼Œå­˜åœ¨å½©è™¹è¡¨æ”»å‡»é£é™©
  - æ²¡æœ‰ä½¿ç”¨ç›å€¼ï¼ˆsaltï¼‰ï¼Œç›¸åŒå¯†ç ç”Ÿæˆç›¸åŒå“ˆå¸Œ
  - æ— æ³•é˜²å¾¡æš´åŠ›ç ´è§£å’Œå­—å…¸æ”»å‡»
- **ä»£ç ä½ç½®**ï¼š[`UserServiceImpl.java:28-31`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/service/impl/UserServiceImpl.java:28-31)

#### 1.3 æ•æ„Ÿä¿¡æ¯æ³„éœ²
- **é—®é¢˜æè¿°**ï¼šé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ˜æ–‡æ•æ„Ÿä¿¡æ¯
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **å…·ä½“é—®é¢˜**ï¼š
  - æ•°æ®åº“å¯†ç ä¸ºç©ºï¼ˆç”Ÿäº§ç¯å¢ƒé£é™©ï¼‰
  - é‚®ç®±æˆæƒç æ˜æ–‡å­˜å‚¨
- **ä»£ç ä½ç½®**ï¼š[`application.properties:12,60`](web-shop-backend/src/main/resources/application.properties:12)

#### 1.4 CORS é…ç½®è¿‡äºå®½æ¾
- **é—®é¢˜æè¿°**ï¼šå…è®¸æ‰€æœ‰åŸŸåè·¨åŸŸè®¿é—®
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **é—®é¢˜åˆ†æ**ï¼š
  - `addAllowedOriginPattern("*")` å…è®¸ä»»ä½•æ¥æºè®¿é—®
  - ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶ä¸ºç‰¹å®šåŸŸå
- **ä»£ç ä½ç½®**ï¼š[`CorsConfig.java:28`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/config/CorsConfig.java:28)

#### 1.5 ç¼ºå°‘è¯·æ±‚æ‹¦æˆªå™¨
- **é—®é¢˜æè¿°**ï¼šæ²¡æœ‰ç»Ÿä¸€çš„è¯·æ±‚æ‹¦æˆªå’ŒéªŒè¯æœºåˆ¶
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **ç¼ºå¤±åŠŸèƒ½**ï¼š
  - Token éªŒè¯æ‹¦æˆªå™¨
  - æƒé™éªŒè¯æ‹¦æˆªå™¨
  - è¯·æ±‚æ—¥å¿—è®°å½•
  - é˜²é‡æ”¾æ”»å‡»æœºåˆ¶

### 2. æ¶æ„è®¾è®¡é—®é¢˜

#### 2.1 å‰ç«¯è·¯ç”±å®ˆå«ä¸å®Œå–„
- **é—®é¢˜æè¿°**ï¼šä»…åœ¨å‰ç«¯è¿›è¡Œæƒé™éªŒè¯ï¼Œåç«¯ç¼ºå°‘å¯¹åº”éªŒè¯
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **é—®é¢˜åˆ†æ**ï¼š
  - å‰ç«¯è·¯ç”±å®ˆå«å¯è¢«ç»•è¿‡
  - åç«¯ API æ²¡æœ‰æƒé™éªŒè¯
  - ç”¨æˆ·å¯ç›´æ¥è°ƒç”¨ API ç»•è¿‡å‰ç«¯é™åˆ¶
- **ä»£ç ä½ç½®ç°åœ¨æˆ‘å·²ç»å……åˆ†äº†è§£äº†é¡¹ç›®çš„ç»“æ„å’Œå®ç°ã€‚è®©æˆ‘åˆ›å»ºä¸€ä¸ªè¯¦ç»†çš„é—®é¢˜åˆ†æå’Œæ”¹è¿›å»ºè®®æ–‡æ¡£ã€‚

<write_to_file>
<path>é¡¹ç›®é—®é¢˜åˆ†æä¸æ”¹è¿›å»ºè®®.md</path>
<content># WebShop é¡¹ç›®é—®é¢˜åˆ†æä¸æ”¹è¿›å»ºè®®

## ä¸€ã€å½“å‰å­˜åœ¨çš„ä¸»è¦é—®é¢˜

### 1. å®‰å…¨é—®é¢˜ï¼ˆä¸¥é‡ï¼‰

#### 1.1 è®¤è¯æˆæƒæœºåˆ¶ç¼ºå¤±
- **é—®é¢˜æè¿°**ï¼šå½“å‰ä½¿ç”¨ Mock Tokenï¼ˆ`mock-token-{userId}`ï¼‰ï¼Œæ²¡æœ‰çœŸå®çš„èº«ä»½éªŒè¯æœºåˆ¶
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **å½±å“èŒƒå›´**ï¼š
  - ä»»ä½•äººéƒ½å¯ä»¥ä¼ªé€  token è®¿é—®ç³»ç»Ÿ
  - æ— æ³•éªŒè¯è¯·æ±‚çš„çœŸå®æ€§å’Œåˆæ³•æ€§
  - ç”¨æˆ·èº«ä»½å¯è¢«è½»æ˜“å†’å……
- **ä»£ç ä½ç½®**ï¼š[`UserController.java:89`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/controller/UserController.java:89)

#### 1.2 å¯†ç åŠ å¯†æ–¹å¼ä¸å®‰å…¨
- **é—®é¢˜æè¿°**ï¼šä½¿ç”¨ MD5 åŠ å¯†å¯†ç ï¼Œå·²è¢«è¯æ˜ä¸å®‰å…¨
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **é—®é¢˜åˆ†æ**ï¼š
  - MD5 ç®—æ³•å·²è¢«ç ´è§£ï¼Œå­˜åœ¨å½©è™¹è¡¨æ”»å‡»é£é™©
  - æ²¡æœ‰ä½¿ç”¨ç›å€¼ï¼ˆsaltï¼‰ï¼Œç›¸åŒå¯†ç ç”Ÿæˆç›¸åŒå“ˆå¸Œ
  - æ— æ³•é˜²å¾¡æš´åŠ›ç ´è§£å’Œå­—å…¸æ”»å‡»
- **ä»£ç ä½ç½®**ï¼š[`UserServiceImpl.java:28-31`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/service/impl/UserServiceImpl.java:28-31)

#### 1.3 æ•æ„Ÿä¿¡æ¯æ³„éœ²
- **é—®é¢˜æè¿°**ï¼šé…ç½®æ–‡ä»¶ä¸­åŒ…å«æ˜æ–‡æ•æ„Ÿä¿¡æ¯
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **å…·ä½“é—®é¢˜**ï¼š
  - æ•°æ®åº“å¯†ç ä¸ºç©ºï¼ˆç”Ÿäº§ç¯å¢ƒé£é™©ï¼‰
  - é‚®ç®±æˆæƒç æ˜æ–‡å­˜å‚¨
- **ä»£ç ä½ç½®**ï¼š[`application.properties:12,60`](web-shop-backend/src/main/resources/application.properties:12)

#### 1.4 CORS é…ç½®è¿‡äºå®½æ¾
- **é—®é¢˜æè¿°**ï¼šå…è®¸æ‰€æœ‰åŸŸåè·¨åŸŸè®¿é—®
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **é—®é¢˜åˆ†æ**ï¼š
  - `addAllowedOriginPattern("*")` å…è®¸ä»»ä½•æ¥æºè®¿é—®
  - ç”Ÿäº§ç¯å¢ƒåº”é™åˆ¶ä¸ºç‰¹å®šåŸŸå
- **ä»£ç ä½ç½®**ï¼š[`CorsConfig.java:28`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/config/CorsConfig.java:28)

#### 1.5 ç¼ºå°‘è¯·æ±‚æ‹¦æˆªå™¨
- **é—®é¢˜æè¿°**ï¼šæ²¡æœ‰ç»Ÿä¸€çš„è¯·æ±‚æ‹¦æˆªå’ŒéªŒè¯æœºåˆ¶
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **ç¼ºå¤±åŠŸèƒ½**ï¼š
  - Token éªŒè¯æ‹¦æˆªå™¨
  - æƒé™éªŒè¯æ‹¦æˆªå™¨
  - è¯·æ±‚æ—¥å¿—è®°å½•
  - é˜²é‡æ”¾æ”»å‡»æœºåˆ¶

### 2. æ¶æ„è®¾è®¡é—®é¢˜

#### 2.1 å‰ç«¯è·¯ç”±å®ˆå«ä¸å®Œå–„
- **é—®é¢˜æè¿°**ï¼šä»…åœ¨å‰ç«¯è¿›è¡Œæƒé™éªŒè¯ï¼Œåç«¯ç¼ºå°‘å¯¹åº”éªŒè¯
- **é£é™©ç­‰çº§**ï¼šğŸ”´ ä¸¥é‡
- **é—®é¢˜åˆ†æ**ï¼š
  - å‰ç«¯è·¯ç”±å®ˆå«å¯è¢«ç»•è¿‡
  - åç«¯ API æ²¡æœ‰æƒé™éªŒè¯
  - ç”¨æˆ·å¯ç›´æ¥è°ƒç”¨ API ç»•è¿‡å‰ç«¯é™åˆ¶
- **ä»£ç ä½ç½®**ï¼š[`index.js:32-87`](web-shop-frontend/src/router/index.js:32-87)

#### 2.2 ç¼ºå°‘ç»Ÿä¸€çš„å“åº”æ ¼å¼
- **é—®é¢˜æè¿°**ï¼šå¼‚å¸¸å¤„ç†è¿”å›æ ¼å¼ä¸ç»Ÿä¸€
- **é£é™©ç­‰çº§**ï¼šğŸŸ¢ ä½
- **é—®é¢˜åˆ†æ**ï¼š
  - æ­£å¸¸å“åº”ä½¿ç”¨ `Result` ç±»
  - å¼‚å¸¸å“åº”ç›´æ¥è¿”å› `Map`
  - å‰ç«¯éœ€è¦å¤„ç†å¤šç§å“åº”æ ¼å¼
- **ä»£ç ä½ç½®**ï¼š[`GlobalExceptionHandler.java`](web-shop-backend/src/main/java/org/javaweb/webshopbackend/config/GlobalExceptionHandler.java)

#### 2.3 ç¼ºå°‘ DTO å’Œ VO åˆ†å±‚
- **é—®é¢˜æè¿°**ï¼šç›´æ¥ä½¿ç”¨å®ä½“ç±»ä½œä¸ºå“åº”å¯¹è±¡
- **é£é™©ç­‰çº§**ï¼šğŸŸ¡ ä¸­ç­‰
- **é—®é¢˜åˆ†æ**ï¼š
  - æ•°æ®åº“å­—æ®µç›´æ¥æš´éœ²ç»™å‰ç«¯
  - éš¾ä»¥æ§åˆ¶è¿”å›å­—æ®µ
  - å®¹æ˜“æ³„éœ²æ•æ„Ÿä¿¡æ¯

### 3. åŠŸèƒ½å®Œå–„æ€§é—®é¢˜

#### 3.1 ç¼ºå°‘ Token åˆ·æ–°æœºåˆ¶
- **é—®é¢˜æè¿°**ï¼šToken æ²¡æœ‰è¿‡æœŸæ—¶é—´å’Œåˆ·æ–°æœºåˆ¶
- **å½±å“**ï¼š
  - æ— æ³•å®ç°è‡ªåŠ¨ç™»å‡º
  - Token æ°¸ä¹…æœ‰æ•ˆå­˜åœ¨å®‰å…¨éšæ‚£
  - ç”¨æˆ·ä½“éªŒä¸ä½³

#### 3.2 ç¼ºå°‘æ—¥å¿—å®¡è®¡åŠŸèƒ½
- **é—®é¢˜æè¿°**ï¼šè™½ç„¶æœ‰ `OperationLog` è¡¨ï¼Œä½†æœªå®Œæ•´å®ç°
- **ç¼ºå¤±åŠŸèƒ½**ï¼š
  - ç™»å½•æ—¥å¿—è®°å½•
  - æ•æ„Ÿæ“ä½œå®¡è®¡
  - å¼‚å¸¸æ“ä½œå‘Šè­¦

#### 3.3 ç¼ºå°‘é™æµå’Œé˜²åˆ·æœºåˆ¶
- **é—®é¢˜æè¿°**ï¼šæ²¡æœ‰æ¥å£é™æµä¿æŠ¤
- **é£é™©**ï¼š
  - å®¹æ˜“è¢«æ¶æ„åˆ·æ¥å£
  - æš´åŠ›ç ´è§£å¯†ç 
  - DDoS æ”»å‡»é£é™©

### 4. ä»£ç è´¨é‡é—®é¢˜

#### 4.1 å¼‚å¸¸å¤„ç†ä¸å¤Ÿç»†è‡´
- **é—®é¢˜æè¿°**ï¼šä½¿ç”¨é€šç”¨çš„ `IllegalArgumentException`
- **å»ºè®®**ï¼šå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç±»ï¼Œä¾¿äºåŒºåˆ†ä¸åŒé”™è¯¯ç±»å‹

#### 4.2 ç¼ºå°‘å‚æ•°æ ¡éªŒ
- **é—®é¢˜æè¿°**ï¼šéƒ¨åˆ†æ¥å£ç¼ºå°‘å®Œæ•´çš„å‚æ•°æ ¡éªŒ
- **é£é™©**ï¼šå¯èƒ½å¯¼è‡´ç©ºæŒ‡é’ˆæˆ–æ•°æ®å¼‚å¸¸

#### 4.3 ç¼ºå°‘å•å…ƒæµ‹è¯•
- **é—®é¢˜æè¿°**ï¼šé¡¹ç›®ç¼ºå°‘å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- **å½±å“**ï¼šä»£ç è´¨é‡éš¾ä»¥ä¿è¯ï¼Œé‡æ„é£é™©é«˜

---

## äºŒã€æ”¹è¿›å»ºè®®ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

1. **å¼•å…¥ JWT è®¤è¯æœºåˆ¶**ï¼ˆè¯¦è§ç¬¬ä¸‰éƒ¨åˆ†ï¼‰
2. **æ›´æ¢å¯†ç åŠ å¯†æ–¹å¼ä¸º BCrypt**
3. **æ·»åŠ åç«¯æƒé™éªŒè¯æ‹¦æˆªå™¨**
4. **ä¿®å¤ CORS é…ç½®**

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå®Œæˆï¼‰

5. å®Œå–„å¼‚å¸¸å¤„ç†æœºåˆ¶
6. æ·»åŠ è¯·æ±‚æ—¥å¿—å’Œå®¡è®¡åŠŸèƒ½
7. å®ç°æ¥å£é™æµ
8. å®Œå–„ DTO/VO åˆ†å±‚

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

9. å¢åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç‡
10. ä¼˜åŒ–ä»£ç ç»“æ„
11. æ·»åŠ æ€§èƒ½ç›‘æ§

---

## ä¸‰ã€JWT è®¤è¯å®ç°æ–¹æ¡ˆ

### 3.1 æŠ€æœ¯é€‰å‹

**æ¨èä½¿ç”¨**ï¼š`jjwt`ï¼ˆJava JWT åº“ï¼‰

**ä¾èµ–é…ç½®**ï¼š
```xml
<!-- JWT -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.12.5</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.12.5</version>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.12.5</version>
    <scope>runtime</scope>
</dependency>
```

### 3.2 å®ç°æ­¥éª¤

#### æ­¥éª¤ 1ï¼šé…ç½® JWT å‚æ•°

åœ¨ `application.properties` ä¸­æ·»åŠ ï¼š
```properties
# JWT é…ç½®
jwt.secret=your-256-bit-secret-key-change-this-in-production
jwt.expiration=86400000
jwt.refresh-expiration=604800000
```

#### æ­¥éª¤ 2ï¼šåˆ›å»º JWT å·¥å…·ç±»

åˆ›å»º `JwtUtil.java`ï¼š
```java
@Component
public class JwtUtil {
    @Value("${jwt.secret}")
    private String secret;
    
    @Value("${jwt.expiration}")
    private Long expiration;
    
    // ç”Ÿæˆ Token
    public String generateToken(Long userId, String username, String role) {
        Map<String, Object> claims = new HashMap<>();
        claims.put("userId", userId);
        claims.put("username", username);
        claims.put("role", role);
        
        return Jwts.builder()
            .setClaims(claims)
            .setSubject(username)
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + expiration))
            .signWith(SignatureAlgorithm.HS256, secret)
            .compact();
    }
    
    // éªŒè¯ Token
    public boolean validateToken(String token) {
        try {
            Jwts.parser().setSigningKey(secret).parseClaimsJws(token);
            return true;
        } catch (Exception e) {
            return false;
        }
    }
    
    // ä» Token ä¸­è·å–ç”¨æˆ·ä¿¡æ¯
    public Claims getClaimsFromToken(String token) {
        return Jwts.parser()
            .setSigningKey(secret)
            .parseClaimsJws(token)
            .getBody();
    }
}
```

#### æ­¥éª¤ 3ï¼šåˆ›å»º JWT æ‹¦æˆªå™¨

åˆ›å»º `JwtInterceptor.java`ï¼š
```java
@Component
public class JwtInterceptor implements HandlerInterceptor {
    @Autowired
    private JwtUtil jwtUtil;
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        // æ”¾è¡Œ OPTIONS è¯·æ±‚
        if ("OPTIONS".equals(request.getMethod())) {
            return true;
        }
        
        // è·å– Token
        String token = request.getHeader("Authorization");
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7);
        }
        
        // éªŒè¯ Token
        if (token == null || !jwtUtil.validateToken(token)) {
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            response.setContentType("application/json;charset=UTF-8");
            response.getWriter().write("{\"code\":401,\"message\":\"æœªæˆæƒæˆ– Token å·²è¿‡æœŸ\"}");
            return false;
        }
        
        // å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥è¯·æ±‚å±æ€§
        Claims claims = jwtUtil.getClaimsFromToken(token);
        request.setAttribute("userId", claims.get("userId"));
        request.setAttribute("username", claims.get("username"));
        request.setAttribute("role", claims.get("role"));
        
        return true;
    }
}
```

#### æ­¥éª¤ 4ï¼šé…ç½®æ‹¦æˆªå™¨

ä¿®æ”¹ `WebMvcConfig.java`ï¼š
```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Autowired
    private JwtInterceptor jwtInterceptor;
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(jwtInterceptor)
            .addPathPatterns("/api/**")
            .excludePathPatterns(
                "/api/user/login",
                "/api/user/register",
                "/api/product/list",
                "/api/product/detail/**",
                "/doc.html",
                "/swagger-ui/**",
                "/v3/api-docs/**"
            );
    }
}
```

#### æ­¥éª¤ 5ï¼šä¿®æ”¹ç™»å½•æ¥å£

ä¿®æ”¹ `UserController.login()` æ–¹æ³•ï¼š
```java
@PostMapping("/login")
public Result<Map<String, Object>> login(@Valid @RequestBody LoginDTO loginDTO) {
    User user = userService.login(loginDTO.getUsername(), loginDTO.getPassword());
    
    // ç”Ÿæˆ JWT Token
    String token = jwtUtil.generateToken(user.getId(), user.getUsername(), user.getRole());
    
    Map<String, Object> data = new HashMap<>();
    data.put("token", token);
    data.put("userInfo", user);
    
    return Result.success("ç™»å½•æˆåŠŸ", data);
}
```

#### æ­¥éª¤ 6ï¼šå‰ç«¯é€‚é…

ä¿®æ”¹å‰ç«¯è¯·æ±‚æ‹¦æˆªå™¨ï¼Œåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  Tokenï¼š
```javascript
// src/utils/request.js
import axios from 'axios'
import { getToken } from './auth'

const request = axios.create({
  baseURL: 'http://localhost:8080',
  timeout: 10000
})

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  config => {
    const token = getToken()
    if (token) {
      config.headers['Authorization'] = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  response => {
    return response.data
  },
  error => {
    if (error.response?.status === 401) {
      // Token è¿‡æœŸï¼Œè·³è½¬ç™»å½•
      clearAuth()
      router.push('/login')
    }
    return Promise.reject(error)
  }
)

export default request
```

### 3.3 Token åˆ·æ–°æœºåˆ¶

#### æ–¹æ¡ˆ 1ï¼šåŒ Token æœºåˆ¶ï¼ˆæ¨èï¼‰

- **Access Token**ï¼šçŸ­æœŸæœ‰æ•ˆï¼ˆå¦‚ 2 å°æ—¶ï¼‰
- **Refresh Token**ï¼šé•¿æœŸæœ‰æ•ˆï¼ˆå¦‚ 7 å¤©ï¼‰

å®ç°æ­¥éª¤ï¼š
1. ç™»å½•æ—¶åŒæ—¶è¿”å›ä¸¤ä¸ª Token
2. Access Token è¿‡æœŸæ—¶ï¼Œä½¿ç”¨ Refresh Token è·å–æ–°çš„ Access Token
3. Refresh Token è¿‡æœŸæ—¶ï¼Œéœ€è¦é‡æ–°ç™»å½•

#### æ–¹æ¡ˆ 2ï¼šæ»‘åŠ¨è¿‡æœŸæ—¶é—´

- æ¯æ¬¡è¯·æ±‚æˆåŠŸåï¼Œè‡ªåŠ¨å»¶é•¿ Token æœ‰æ•ˆæœŸ
- é€‚åˆç”¨æˆ·æ´»è·ƒåº¦é«˜çš„åœºæ™¯

### 3.4 æƒé™æ§åˆ¶å¢å¼º

#### åˆ›å»ºæƒé™æ³¨è§£

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequireRole {
    String[] value();
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```java
@RequireRole({"admin", "merchant"})
@GetMapping("/admin/users")
public Result<List<User>> getUserList() {
    // ä»…ç®¡ç†å‘˜å’Œå•†å®¶å¯è®¿é—®
}
```

### 3.5 å®‰å…¨å¢å¼ºå»ºè®®

1. **å¯†ç åŠ å¯†å‡çº§**ï¼š
   ```java
   // ä½¿ç”¨ BCrypt
   @Bean
   public PasswordEncoder passwordEncoder() {
       return new BCryptPasswordEncoder();
   }
   ```

2. **æ·»åŠ è¯·æ±‚ç­¾åéªŒè¯**ï¼šé˜²æ­¢å‚æ•°ç¯¡æ”¹

3. **å®ç°æ¥å£é™æµ**ï¼š
   ```java
   @RateLimiter(limit = 10, period = 60) // 60ç§’å†…æœ€å¤š10æ¬¡
   @PostMapping("/login")
   public Result login() { }
   ```

4. **æ·»åŠ  IP é»‘åå•**ï¼šé˜²æ­¢æ¶æ„æ”»å‡»

5. **å®ç°ç™»å½•å¤±è´¥é”å®š**ï¼šè¿ç»­å¤±è´¥ 5 æ¬¡é”å®š 30 åˆ†é’Ÿ

---

## å››ã€å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2 å¤©ï¼‰
- [ ] æ·»åŠ  JWT ä¾èµ–
- [ ] å®ç° JWT å·¥å…·ç±»
- [ ] åˆ›å»º JWT æ‹¦æˆªå™¨
- [ ] ä¿®æ”¹ç™»å½•æ¥å£

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-3 å¤©ï¼‰
- [ ] æ›´æ¢å¯†ç åŠ å¯†æ–¹å¼ä¸º BCrypt
- [ ] å®Œå–„æƒé™éªŒè¯æœºåˆ¶
- [ ] æ·»åŠ è¯·æ±‚æ—¥å¿—
- [ ] å‰ç«¯é€‚é… JWT

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ3-5 å¤©ï¼‰
- [ ] å®ç° Token åˆ·æ–°æœºåˆ¶
- [ ] æ·»åŠ æ¥å£é™æµ
- [ ] å®Œå–„å¼‚å¸¸å¤„ç†
- [ ] æ·»åŠ å®¡è®¡æ—¥å¿—

### ç¬¬å››é˜¶æ®µï¼ˆæŒç»­ä¼˜åŒ–ï¼‰
- [ ] å¢åŠ å•å…ƒæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨åŠ å›º
- [ ] æ–‡æ¡£å®Œå–„

---

## äº”ã€æ€»ç»“

å½“å‰é¡¹ç›®åœ¨åŠŸèƒ½å®ç°ä¸ŠåŸºæœ¬å®Œæ•´ï¼Œä½†åœ¨**å®‰å…¨æ€§**æ–¹é¢å­˜åœ¨ä¸¥é‡ä¸è¶³ã€‚å»ºè®®ä¼˜å…ˆå®æ–½ JWT è®¤è¯æœºåˆ¶å’Œå¯†ç åŠ å¯†å‡çº§ï¼Œè¿™æ˜¯ä¿éšœç³»ç»Ÿå®‰å…¨çš„åŸºç¡€ã€‚åç»­å¯ä»¥é€æ­¥å®Œå–„å…¶ä»–åŠŸèƒ½ï¼Œæå‡ç³»ç»Ÿçš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

**å…³é”®æé†’**ï¼š
- ğŸ”´ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®å¤æ‰€æœ‰é«˜ä¼˜å…ˆçº§é—®é¢˜
- ğŸ”‘ JWT Secret å¿…é¡»ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²
- ğŸ”’ æ•æ„Ÿé…ç½®åº”ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒ
- ğŸ“ æ‰€æœ‰æ•æ„Ÿæ“ä½œå¿…é¡»è®°å½•å®¡è®¡æ—¥å¿—